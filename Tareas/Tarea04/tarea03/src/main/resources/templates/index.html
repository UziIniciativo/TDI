<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: base('Crédito y pagos de tarjeta (Tarea 4)', ~{::body})}">
<head>
  <meta charset="UTF-8">
  <title>Crédito y pagos</title>
</head>
<body>

<form th:action="@{/guardar}" th:object="${credito}" method="post" class="mb-4">

  <!-- TABS JQUERY UI -->
  <div id="tabs">
    <ul>
      <li><a href="#tab-credito">Datos del crédito</a></li>
      <li><a href="#tab-pagos">Gastos y pagos de tarjetas</a></li>
    </ul>

    <!-- TAB 1: Datos del crédito -->
    <div id="tab-credito" class="mt-3">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Fecha</label>
          <!-- type="text" para usar jQuery UI datepicker -->
          <input type="text" th:field="*{fecha}" id="fecha"
                 class="form-control" required>
        </div>

        <div class="col-md-4">
          <label class="form-label">Moneda</label>
          <div class="form-check">
            <input class="form-check-input" type="radio"
                   th:field="*{moneda}" value="Soles (S/.)" checked>
            <label class="form-check-label">Soles (S/.)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio"
                   th:field="*{moneda}" value="Dólares (US$)">
            <label class="form-check-label">Dólares (US$)</label>
          </div>
        </div>

        <div class="col-md-3">
          <label class="form-label">Monto</label>
          <input type="number" th:field="*{monto}"
                 step="0.01" min="0" class="form-control" required>
        </div>

        <div class="col-md-2">
          <label class="form-label">Periodo (meses)</label>
          <input type="number" th:field="*{periodoMeses}"
                 min="1" class="form-control" required>
        </div>

        <div class="col-md-3">
          <label class="form-label">Cuota</label>
          <input type="number" th:field="*{cuota}"
                 step="0.01" min="0" class="form-control">
        </div>

        <div class="col-md-3">
          <label class="form-label">TEA (%)</label>
          <input type="number" th:field="*{tea}"
                 step="0.01" min="0" class="form-control">
        </div>

        <div class="col-md-3">
          <label class="form-label">Fecha de vencimiento</label>
          <!-- también con datepicker -->
          <input type="text" th:field="*{fechaVenc}" id="fechaVenc"
                 class="form-control">
        </div>
      </div>
    </div>

    <!-- TAB 2: Tabla de movimientos y pagos -->
    <div id="tab-pagos" class="mt-3">
      <h2 class="h5">Gastos y pagos de tarjetas de crédito</h2>
      <p class="text-muted">
        Las columnas <strong>Fecha, Mes, Tarjeta, Transacción y Gastos</strong> provienen de la base de datos y no se pueden editar.
        Solo la columna <strong>Pagos</strong> es editable.
      </p>

      <!-- AUTOCOMPLETE: buscar transacción -->
      <div class="mb-3">
        <label class="form-label">Buscar transacción (Autocomplete jQuery UI)</label>
        <input type="text" id="buscarTransaccion"
               class="form-control"
               placeholder="Escriba 'Pel', 'Teatro', 'Cine', etc.">
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Fecha</th>
              <th>Mes</th>
              <th>Tarjeta</th>
              <th>Transacción</th>
              <th>Gastos</th>
              <th>Pagos</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="mov, iter : ${movimientos}">
              <td th:text="${mov.fecha}"></td>
              <td th:text="${mov.mes}"></td>
              <td th:text="${mov.tarjeta}"></td>
              <td th:text="${mov.transaccion}"></td>
              <td th:text="${mov.gastos}"></td>

              <td>
                <input type="number"
                       class="form-control form-control-sm"
                       step="0.01"
                       th:name="${'pagos[' + iter.index + '].monto'}"
                       th:value="${mov.pagos}">
                <input type="hidden"
                       th:name="${'pagos[' + iter.index + '].id'}"
                       th:value="${mov.id}">
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div><!-- /tabs -->

  <div class="mt-3">
    <button type="submit" class="btn btn-primary">Aceptar</button>
  </div>

</form>

<!-- SCRIPT jQuery UI: Tabs, Datepicker y Autocomplete -->
<script th:inline="javascript">
  $(function () {
    // 1) Tabs
    $("#tabs").tabs();

    // 2) Datepicker en fechas (formato ISO para que lo entienda Spring)
    $("#fecha, #fechaVenc").datepicker({
      dateFormat: "yy-mm-dd"
    });

    // 3) Autocomplete para buscar transacción
    var transacciones = [
      "Peluquería",
      "TV plasma (1 de 6)",
      "Vajilla Kit",
      "YouTube Premium",
      "Pasaje Londres",
      "Pago Mastercard",
      "Teatro",
      "Pago VISA",
      "Cine",
      "Libros x 5"
    ];

    $("#buscarTransaccion").autocomplete({
      source: transacciones,
      minLength: 1
    });
  });
</script>

</body>
</html>
